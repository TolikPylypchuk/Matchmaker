<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Matching with Fallthrough </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Matching with Fallthrough ">
    <meta name="generator" content="docfx 2.47.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="matching-with-fallthrough">Matching with Fallthrough</h1>

<p>C and C++ support fallthrough in <code>switch</code> expressions.
So does this library, although it works differently here.
If fallthrough is enabled, then after successfully matching a
pattern, a match expression will fall through to the
<em>next successful</em> pattern.</p>
<h2 id="match-statements-with-fallthrough">Match Statements with Fallthrough</h2>
<p>Let's start with match statements. The <code>Case</code> methods are overloaded
to accept a boolean value which indicates the fallthrough behaviour.
If fallthrough is enabled for a pattern, then the statement will
continue searching for the next successful pattern.</p>
<p>Notice, that fallthrough is configured for each pattern individually.
This means that when a pattern with no fallthrough is matched successfully,
the statement stops searching.</p>
<p>The default fallthrough value can be specified in the <code>Match.Create</code> method.</p>
<p>You should bear in mind that just adding patterns with fallthrough will
not force the match statement to actually take them into account.
In order to match with fallthrough, you should use the <code>ExecuteWithFallthrough</code>
(or <code>ExecuteStrictWithFallthrough</code>). The reason the fallthrough behaviour
is implemented in different methods is that they return different results.
<code>ExecuteOn</code> returns a boolean value which denotes whether a match was successful.
<code>ExecuteStrict</code> doesn't return anything and throws an exception if the match wasn't
succcessful. But both <code>ExecuteWithFallthrough</code> and <code>ExecuteStrictWithFallthrough</code> return
an int which denotes how many patterns were matched successfully.</p>
<h2 id="nondeterministic-matching">Nondeterministic Matching</h2>
<p>What about match expressions? If they can also be executed with fallthrough,
then what should be the return value? There are at least two options:</p>
<ol>
<li><p>The result of the last successful pattern match is the result of the expression.
I've decided against it because some results will be ignored and the order of the
patterns will matter significantly. Although there would be one upside - it's
consistent with multicasting non-void delegates.</p>
</li>
<li><p>The result of every successful pattern is the result of the expression. This
means that the expression actually returns a <em>list</em> of results. This is the
option I chose, because it would allow for nondeterministic matching and subsequent
use of the nondeterministic result. I have no idea whether it's actually useful,
but it's an interesting idea nonetheless.</p>
</li>
</ol>
<p>Just like for match statemens, the <code>Case</code> methods and the <code>Match.Create</code> method are
overloaded to specify the fallthrough behaviour. It is also configured for each
pattern individually.</p>
<p>In order to match with fallthrough, you should use the <code>ExecuteWithFallthrough</code>
(or <code>ExecuteNonStrictWithFallthrough</code>). These methods return a <code>Lst</code> of results
(an immutable list type from <a href="https://github.com/louthy/language-ext">language-ext</a>).
A non-strict version will return an empty list if no patterns were matched successfully.
A strict version will throw an exception in that case.</p>
<h2 id="an-example">An Example</h2>
<p>Here's the implementation of the famous fizz-buzz program which uses nondeterministic matching:</p>
<pre><code>SimplePattern&lt;int&gt; DivisibleBy(int n)
    =&gt; new SimplePattern&lt;int&gt;(input =&gt; input % n == 0);

var result = Enumerable.Range(0, 15)
    .Select(Match.Create&lt;int, string&gt;(fallthroughByDefault: true)
        .Case(DivisibleBy(3), _ =&gt; &quot;Fizz&quot;)
        .Case(DivisibleBy(5), _ =&gt; &quot;Buzz&quot;)
        .Case(Not(DivisibleBy(3) | DivisibleBy(5)), n =&gt; n.ToString())
        .ToFunctionWithFallthrough())
    .Select(items =&gt; items.Aggregate(String.Concat));

// The result is List(&quot;FizzBuzz&quot;, &quot;1&quot;, &quot;2&quot;, &quot;Fizz&quot;, &quot;4&quot;, &quot;Buzz&quot;, &quot;Fizz&quot;, &quot;7&quot;, &quot;8&quot;, &quot;Fizz&quot;, &quot;Buzz&quot;, &quot;11&quot;, &quot;Fizz&quot;, &quot;13&quot;, &quot;14&quot;, &quot;FizzBuzz&quot;);
</code></pre>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/TolikPylypchuk/PatternMatching/blob/master/PatternMatching.Docs/articles/fallthrough.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <div>Copyright (c) 2018 Tolik Pylypchuk</div><span>Generated by <strong>DocFx</strong>.</span> <span>Icons made by <a href="https" ://www.flaticon.com/authors/roundicons"="" title="Roundicons">Roundicons</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></span>
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
